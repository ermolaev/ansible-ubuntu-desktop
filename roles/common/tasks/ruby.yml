---
- name: remove ruby
  apt:
    name: ruby
    state: absent
  tags: rub

- name: Import GPG keys for rvm
  shell: 'gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3'
  changed_when: False
  become: yes
  become_user: '{{ username }}'
  args:
    chdir: /home/{{ username }}

- name: install rvm with ruby
  shell: "curl -sSL https://get.rvm.io | bash -s stable --ruby"
  become: yes
  become_user: '{{ username }}'
  args:
    chdir: /home/{{ username }}

- name: Disable rdoc
  lineinfile:
    dest: "/home/{{ username }}/.gemrc"
    line: "gem: --no-rdoc --no-ri"
    create: yes
    owner: "{{ username }}"

- name: remove troublesome rvm line from .bashrc
  lineinfile:
    dest: "{{ ansible_env.HOME }}/.bashrc"
    state: absent
    regexp: '"$PATH:$HOME/.rvm/bin"'

- name: add rvm line to profile
  lineinfile:
    dest: "{{ ansible_env.HOME }}/.bashrc"
    state: present
    line: '[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm" # Load RVM into a shell session *as a function*'
